---
layout: page
title:  "曲线和网格"
author: mosfet
category: scene
tags: 场景 曲线 网格
---
在计算机图形领域，某些测试模型具有标志性名声，如犹他州茶壶(utah teapot)、斯坦福兔子(stanford bunny)。该茶壶是计算机图形学的象征。  
有趣的是，这两个模型是由参数曲面和物理扫描两种方式建模的，为了在光栅管道可用，也被预处理为网格数据。  
```
see, https://en.wikipedia.org/wiki/List_of_common_3D_test_models
```
笔者认为，几乎所有方式表达的模型形式都可以最终被预处理为网格，从根本上来说，网格代表了数学上详细、光滑曲面或者体积数据的近似的存在。  
对象顺序渲染从原图开始处理对象，曲面通常预先计算为网格集合。因此，我们大概可以找到这两种方式各自对于处理曲面的观点差异。  

但我们提出一个有关渲染的疑问来结束这些模型形式的讨论。图像顺序渲染研究的对象通常不是原图，但究竟是否可以在同等数量的情况下渲染它们？答案通常是，很困难，甚至流行的社区中几乎没有演示。
这种计算量超出想象。即使只有少量三角形，也必须使用加速结构。  
单片段着色器的实际实现中，唯一的选择是硬编码它们进行编译，包括可见性结构的测试，完全手工。  

---
## 数学曲线
```
Focg15.
M3d11.
```
曲面本身由数学进行表达，正如我们所熟悉的，图形中经常使用隐式或参数形式。  

数学上指定曲线(curve)有三种形式，**①隐式②参数；③生成程序曲线。**生成点，但与前两类无关。  
某些曲线的名称由于其形状广为人知，另一些几乎可以是任何形状，它们是自由(free-form)曲线。  
我们已经发现特定曲线同时存在简单的隐式和参数形式，例如圆形，但通常情况下很难找到参数表示。  

本节主要讨论参数曲线，经常，我们考虑以**标准化**`0..1`域索引曲线。复杂的曲线是由多个参数曲线**划分、合并**构造(divide-and-conquer)的。许多简单的较小零件类型都很实用。我们可能对一条曲线某个位置的观察感兴趣，如曲率、方向。在创建方面，我们期望一条曲线经过我们想要的点，称为插值点。该插值结果的特定域称为插值域。  

### cubic
立方参数曲线已通过计算机图形应用程序广泛使用。  
```ruby
# cubic curve
# t               0..1
# T(t)=[1tt²t³]  [1, 0..1]
p(t) = a(vec3)+bt+ct²+dt³ {
  x: a.x(1)+b.x(t)+c.x(t²)+d.x(t³)
  y: z:
}
     = [a b c d]*[1,t,t²,t³]
     = C*T(t)
&&
d(pt)/dt = C*dT(t)/dt = C[0,1,2t,3t²]
```
注意，向量视为点或方向配重以**标准化域**的参数`t`的不同配比相加。对于每个向量的组件，也可以视为单独这样做。  
```ruby
p0(t) + p1(1-t)            # move between，配重 线性插值
ro + (t)rd0 + (t²)rd1 + .. # 非线性配重
```

复杂曲线通常由多个较小的碎片组成，透过碎片的端点(endpoints)处连接一起。  
而在两个相邻部分的连接点(join point)上，存在参数连续性和几何连续性的抽象`C^nth/G^nth`。  
C1意味连接点上两者触线方向和大小相同，G1表示仅触线方向相同，数字表示到达相同方向且大小不为0的差分次数。Cn隐含了Gn连续性，除非n的速率是0。G0/C0仅简单表示共享完全相同的端点。  

独特的曲线则由几何约束定义，包括端点位置以及速率。在立方曲线中，因为有四个向量以及4个域衍生的配重，因此具有四个约束。这种形式如下：  
这种表示方法中，左侧括号内的表达式称为拌和函数(blending funciton)，因为可视为某种配重和该向量自身的固定配重的组合。  
通常几何矩阵是约束构成的，而基矩阵通过定义到达特定约束需要的组合配重得到，使曲线在特定约定参数上满足所有约束点。  
```ruby
Q(t) = Σ(ai+bit+cit²+dit³)gi # g ref to constraint
     = [g][a b c d]*T(t)
     = GMT(t)
  # G ref geometry matrix, M ref basis matrix
```

### Hermite
立方Hermite曲线由两个端点P1和P2定义，而速率方向T1和T2在这些端点处。  
通俗来说，这是要求解：
```ruby
H(0)    = [P P T T]M (1,0,0,0) = P1    # recall  [1,t,t²,t³]
D(H(0)) = [P P T T]M (0,1,0,0) = T1    # recall this D(ht) = C[0,1,2t,3t²]
```
基矩阵提供了拌合函数的固定部分，使我们将P1，P2，T1和T2的与各参数配重通过某种方式组合起来。  
```ruby
H(t) = (1-3t²+2t³)p1 + t²(3-2t)p2 + t(t-1)²t1 + t²(t-1)t2
```
在四组拌和函数中，前两个分别在`0/1`域达到`1/0`，这插值了它们。  
若两条Hermite曲线共享一个端点P2，则几何矩阵`Ga,Gb`应该顺序包含三个点的两个，对于`T2`，若速率不匹配`T2a = uT2b`，则达成了`G1`连续性，若完全相等`T2a = T2b`，则满足参数连续性。  