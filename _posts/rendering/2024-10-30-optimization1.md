---
layout: page
title:  "GI优化技术"
author: mosfet
category: rendering
tags: 全局照明 优化
---

本文需要更新。  

## 辐射度——后篇
辐射度基础中的一些未能解释的细节以及错误在这里说明，这些缺失在实践中被证明很重要，目前暂时也在本文进行补充。  

**随机量、PDF和随机值期望**。  
**review1**开篇我们说明了一种纯微积分式计算函数平均值的方法：这相当于通过格逐步进行完整测量，积分比率为函数总值(Σfdu)和域总值(Σ1du)，这很容易理解。  

通常我们关心采样随机量的连续结果(itv1)分布情况。出现次数(或者相对频率)可能以各个密度分布表示，但该密度是一个相对值，较小仅概念上表达相对更小。一旦使其积分为1，则这些密度分布进而称为PDF，因为积分可以表示概率。在该总定值下，您应该明白，均匀密度的实际值可能由域(itv1)大小计算，越宽，则该常量也越小。  
讨论PDF的速率在这里可能没什么用，但它表示密度的速率，即相对频次在接下来的变化。  
第二个概念是x~p的期望，
```ruby
E(x) = ∫x*p(x)dx           # but why?

1 = ∫p(x)dx
```
由于表示概率，积分的每项表示`prob * x~`，如果我们视概率为实际频次的比例，期望本质上由以下式给出：  
```ruby
1000 x1 + 1000 x2 + ...   # seems equal prob, so 0.5 respectively
  /  2000                 # if you normalize sampled times, coefficients are just normlized probs and divide /1.0
= 0.5x1 + 0.5x2 / 1
= x1+x2 / 2

# rewrite with normaliztion
# thats our E(x)!
(0.5)(x1+x2) / 1
#pxdx   x
```
有兴趣的读者可以研究一下和比率方法有无联系，1可以替换为概率的积分，或者这只是期望的另一种新表达方式。  

## 回顾蒙特卡洛
笔者习惯上避免重复解释前提知识。本节是一种例外，蒙特卡洛方法的证明链接相当复杂，以至于我需要单独写一个快速回顾的版本，而省去阅读基础的大量时间。
若您现在脑海中还很熟悉它们，请轻松跳过本节。  

**估值器**  
由PDF概率密度描述的采样分布，其期望为`E(x) = ∫x*p(x)dx`。  

当密度相同时，独立样本`x1+x2+.../n`将估值同样的结果，而无需求解实际积分形式，因为实践上复杂的`x`无任何解析形式。  
注意密度以修正迭代值。  
```ruby
E(f(x)) = ∫f(x)p(x)dx           # E本身就是两项
        ~= 1/N * Σ(i=1..N)xi.   # 数值均值估计

        # 通常，将估计写成g/p的形式称为蒙特卡洛积分
E(f(x)) = ∫f(x)p(x)dx
        ~= 1/N [Σ(i=1..N)g(xi)/p(xi)]
        # 即原始的f(x)p(x) = g，并显式除以p
```

---
## 参考1
熟悉[《Ray Tracing: The Rest of Your Life》](https://raytracing.github.io/books/RayTracingTheRestOfYourLife.html)这本书的读者  
可能记得Peter Shirley列举了几种重要性采样的实践，如更匹配漫反射BRDF的PDF和非均匀采样。更具启发意义的可能是灯光PDF以及采样(强制导向灯光)。这种直接光采样不同于常规的全局照明方法，但可以达到基本正确的结果。如果您理解了全局光照的问题，则可以理解这种方法的合理性。我在这里再次强调理解问题本身更重要，而不是推崇某种解决方案，读者需要自己理解可行性并决定自己的使用偏好。  
若不清楚选择PDF以及采样行为对结果的不同影响，请见光线追踪一文。  
<div class="x gr txac">
  <div class="x la flex mg0">
    <div class="x la item3-lg item12 pd0">
      <img src="/assets/i/4-1.png">
    </div>
  </div>
  <p>图1：增强灯光的贡献</p>
</div>

